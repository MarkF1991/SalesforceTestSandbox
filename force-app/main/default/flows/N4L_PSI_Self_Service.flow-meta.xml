<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Post an error message to PS to notify that there is no user found</description>
        <name>Admin_User_not_found_Deactivate</name>
        <label>Admin User not found - Deactivate</label>
        <locationX>5330</locationX>
        <locationY>566</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>User not found with user id: {!deactive_adminUserId}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>deactive_adminUserId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post an error message to PS to norify that there is no contact found</description>
        <name>Contact_not_found</name>
        <label>Contact not found</label>
        <locationX>4010</locationX>
        <locationY>566</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>No contact found with id corresponding to user: {!userIdForUpdate}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>userIdForUpdate</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Error_Sending_Updated_Contact_Email</name>
        <label>Error Sending Updated Contact Email</label>
        <locationX>2954</locationX>
        <locationY>1214</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>getContactForUpdate.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post an error message to PS to notify that there is an error updating the contact record</description>
        <name>Error_Updating_Contact</name>
        <label>Error Updating Contact</label>
        <locationX>3218</locationX>
        <locationY>998</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>Error encountered when trying to update contact: {!getContactForUpdate.Id} (related to User ID {!userIdForUpdate} )</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>userIdForUpdate</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post an error message to PS to notify that there is an error updating the user record</description>
        <name>Error_Updating_User</name>
        <label>Error Updating User</label>
        <locationX>3482</locationX>
        <locationY>890</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>Error encountered when trying to update user: {!userIdForUpdate}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>userIdForUpdate</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Extracts varaibles from the JSON:

adminContactId: string
contactId: string
firstName: string
lastName: string
phoneNumber: number</description>
        <name>Parse_JSON</name>
        <label>Parse JSON</label>
        <locationX>2690</locationX>
        <locationY>242</locationY>
        <actionName>MultipleJSONParser</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>getUserToUpdate</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>fieldName1</name>
            <value>
                <stringValue>userId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName2</name>
            <value>
                <stringValue>firstName</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName3</name>
            <value>
                <stringValue>lastName</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName4</name>
            <value>
                <stringValue>phoneNumber</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName5</name>
            <value>
                <stringValue>adminUserId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName6</name>
            <value>
                <stringValue>contactId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ignore_error</name>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>jsonStringToParse</name>
            <value>
                <elementReference>PSIRecord.Data__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>MultipleJSONParser</nameSegment>
        <outputParameters>
            <assignToReference>userIdForUpdate</assignToReference>
            <name>Value01</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>firstNameForUpdate</assignToReference>
            <name>Value02</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>lastNameForUpdate</assignToReference>
            <name>Value03</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>phoneNumberForUpdate</assignToReference>
            <name>Value04</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>adminUserId</assignToReference>
            <name>Value05</name>
        </outputParameters>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Parse_JSON_deactivated</name>
        <label>Parse JSON - deactivated</label>
        <locationX>4802</locationX>
        <locationY>242</locationY>
        <actionName>MultipleJSONParser</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>getUserToDeactivate</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>fieldName1</name>
            <value>
                <stringValue>adminUserId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName2</name>
            <value>
                <stringValue>userId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName3</name>
            <value>
                <stringValue>actionType</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName4</name>
            <value>
                <stringValue>schoolId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ignore_error</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>jsonStringToParse</name>
            <value>
                <elementReference>PSIRecord.Data__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>MultipleJSONParser</nameSegment>
        <outputParameters>
            <assignToReference>deactive_adminUserId</assignToReference>
            <name>Value01</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>deactivate_userId</assignToReference>
            <name>Value02</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>deactivate_ActionType</assignToReference>
            <name>Value03</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>deactivate_schoolId</assignToReference>
            <name>Value04</name>
        </outputParameters>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Call Apex to Parse JSON string in PSI record Data field.</description>
        <name>Parse_JSON_Values</name>
        <label>Parse JSON Values</label>
        <locationX>908</locationX>
        <locationY>242</locationY>
        <actionName>MultipleJSONParser</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Update_ACR_with_Ts_Cs_Accepted_Date</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>fieldName1</name>
            <value>
                <stringValue>accountId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName2</name>
            <value>
                <stringValue>contactId</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName3</name>
            <value>
                <stringValue>whenSigned</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName4</name>
            <value>
                <stringValue>link</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fieldName5</name>
            <value>
                <stringValue>isPrincipal</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ignore_error</name>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>jsonStringToParse</name>
            <value>
                <elementReference>PSIRecord.Data__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>MultipleJSONParser</nameSegment>
        <outputParameters>
            <assignToReference>AccountId</assignToReference>
            <name>Value01</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>ContactId</assignToReference>
            <name>Value02</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>TsAndCsAcceptedText</assignToReference>
            <name>Value03</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>loginLink</assignToReference>
            <name>Value04</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>isPrincipal</assignToReference>
            <name>Value05</name>
        </outputParameters>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Post_Error_Active_Product_Exists</name>
        <label>Post Error: Active Product Exists</label>
        <locationX>50</locationX>
        <locationY>2096</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_email_template</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>There is an existing Self Service - School Reporting product active for this school</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Post_error_Email_failed_to_send</name>
        <label>Post error: Email failed to send</label>
        <locationX>2162</locationX>
        <locationY>2894</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post an error message to PS to notify that there is no SS opportunity for the school</description>
        <name>Post_error_No_Opportunity</name>
        <label>Post error: No Opportunity</label>
        <locationX>710</locationX>
        <locationY>1490</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Check_for_Existing_Self_Service_Product</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>There is no Self Service - School Reporting opportunity for this school</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post reply with error message - error occurred during opportunity update</description>
        <name>Post_Error_Opportunity_update_error</name>
        <label>Post Error - Opportunity update error</label>
        <locationX>446</locationX>
        <locationY>1598</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Check_for_Existing_Self_Service_Product</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Post_error_Product_creation_failed</name>
        <label>Post error: Product creation failed</label>
        <locationX>1106</locationX>
        <locationY>2312</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Get_email_template</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post success message to PS</description>
        <name>Post_success_message</name>
        <label>Post success message</label>
        <locationX>908</locationX>
        <locationY>3110</locationY>
        <actionName>PostApiForSuccessMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForSuccessMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Deactivated_Email</name>
        <label>Send Deactivated Email</label>
        <locationX>4538</locationX>
        <locationY>890</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>getUserToDeactivate.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>emailFromAddress</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Get_Deactivation_Email.Subject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>DeactivatedUserEmailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Email</name>
        <label>Send Email &quot;Self Service: Your details have been updated&quot;</label>
        <locationX>2690</locationX>
        <locationY>1106</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <faultConnector>
            <targetReference>Error_Sending_Updated_Contact_Email</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>getUserToUpdate.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>emailFromAddress</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>getUpdatedContactEmailTemplate.Subject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>UpdatedContactDetailsEmailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Send email to the contact</description>
        <name>Send_email_4a_You_re_all_set_up</name>
        <label>Send email 4a - You&apos;re all set up!</label>
        <locationX>908</locationX>
        <locationY>2786</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Log_email_sent</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Post_error_Email_failed_to_send</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>emailHTMLbody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>EmailRecipient.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>emailFromAddress</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Get_email_template.Subject</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Removed_From_School_Email</name>
        <label>Send Removed From School Email</label>
        <locationX>4802</locationX>
        <locationY>890</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>getUserToDeactivate.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>emailFromAddress</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>Subject_RemovedFromSchoolEmail</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>RemovedFromSchoolEmailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post an error message to PS to notify that there is no user found</description>
        <name>User_not_found</name>
        <label>User not found</label>
        <locationX>4274</locationX>
        <locationY>458</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>User not found with user id:  {!userIdForUpdate}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>userIdForUpdate</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Post an error message to PS to notify that there is no user found</description>
        <name>User_not_found_Deactivate</name>
        <label>User not found - Deactivate</label>
        <locationX>5594</locationX>
        <locationY>458</locationY>
        <actionName>PostApiForErrorMessagesController</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>action</name>
            <value>
                <elementReference>PSIRecord.Flow_Method__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>errorMessages</name>
            <value>
                <stringValue>User not found with user id: {!deactivate_userId}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>eventType</name>
            <value>
                <elementReference>PSIRecord.Flow_Service_Name__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>Ids</name>
            <value>
                <elementReference>deactivate_userId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>internalReferenceId</name>
            <value>
                <elementReference>PSIRecord.Reference_Id__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>origin</name>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputParameters>
        <nameSegment>PostApiForErrorMessagesController</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>57.0</apiVersion>
    <assignments>
        <description>Add the Opportunity IDs to a collection of IDs that will be updated to Stage = Won</description>
        <name>Add_to_Update_Collection</name>
        <label>Add to Update Collection</label>
        <locationX>534</locationX>
        <locationY>1106</locationY>
        <assignmentItems>
            <assignToReference>opportunitiesForUpdate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Opportunities.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Opportunities</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assign the contact from event property contactId as the email recipient for the email sent. This should be the principal of the school because isPrincipal = TRUE</description>
        <name>Assign_event_contact_as_email_recipient</name>
        <label>Assign event contact as email recipient</label>
        <locationX>446</locationX>
        <locationY>674</locationY>
        <assignmentItems>
            <assignToReference>EmailRecipient</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Contact_Record</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Onboarding_Opportunities_for_School</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assign the principal of the school as the email recipient for the email sent.</description>
        <name>Assign_school_principal_as_email_recipient</name>
        <label>Assign school principal as email recipient</label>
        <locationX>1370</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>EmailRecipient</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Principal</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_email_template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>assignValuesForUpdate</name>
        <label>assignValuesForUpdate</label>
        <locationX>2690</locationX>
        <locationY>674</locationY>
        <assignmentItems>
            <assignToReference>getContactForUpdate.FirstName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>firstNameForUpdate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>getContactForUpdate.LastName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>lastNameForUpdate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>getContactForUpdate.MobilePhone</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>phoneNumberForUpdate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>getUserToUpdate.FirstName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>firstNameForUpdate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>getUserToUpdate.LastName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>lastNameForUpdate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>getUserToUpdate.MobilePhone</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>phoneNumberForUpdate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>updateUserForUpdate</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Check Event Type to determine whether to call subflows for email send, or continue with acknowledge Ts and Cs (Sign) flow.</description>
        <name>Check_Self_Service_Event_Type</name>
        <label>Check Self Service Event Type</label>
        <locationX>3383</locationX>
        <locationY>134</locationY>
        <defaultConnector>
            <targetReference>N4l_PSI_Self_Service_Sending_Emails</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Send Emails</defaultConnectorLabel>
        <rules>
            <name>Ts_and_Cs</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>PSIRecord.Flow_Service_Name__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>SelfServiceSign</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Parse_JSON_Values</targetReference>
            </connector>
            <label>Ts and Cs</label>
        </rules>
        <rules>
            <name>Update_Contact</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>PSIRecord.Flow_Service_Name__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>SelfService-UpdateContact</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Parse_JSON</targetReference>
            </connector>
            <label>Update Contact</label>
        </rules>
        <rules>
            <name>Deactivate_Contact</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>PSIRecord.Flow_Service_Name__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>SelfService-DeactivateUser</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Parse_JSON_deactivated</targetReference>
            </connector>
            <label>Deactivate Contact</label>
        </rules>
    </decisions>
    <decisions>
        <name>Deactivate_Or_Remove_From_School</name>
        <label>Deactivate Or Remove From School</label>
        <locationX>4802</locationX>
        <locationY>566</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Deactivate_User</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>deactivate_ActionType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>deactivateUser</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Deactivate_User_Platform_Event</targetReference>
            </connector>
            <label>Deactivate User</label>
        </rules>
        <rules>
            <name>Remove_From_school</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>deactivate_ActionType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>removeFromSchool</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>getSchoolRemovedFrom</targetReference>
            </connector>
            <label>Remove From school</label>
        </rules>
    </decisions>
    <decisions>
        <description>Checks if there is an Onboarding Opportunity for the Self Service product.</description>
        <name>Onboarding_Opportunity</name>
        <label>Onboarding Opportunity</label>
        <locationX>446</locationX>
        <locationY>1382</locationY>
        <defaultConnector>
            <targetReference>Post_error_No_Opportunity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No Opportunity</defaultConnectorLabel>
        <rules>
            <name>Existing_Opportunity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opportunitiesForUpdate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Opportunity_as_Won</targetReference>
            </connector>
            <label>Existing Opportunity</label>
        </rules>
    </decisions>
    <decisions>
        <description>Check the Onboarding Product based on the related Campaign product.</description>
        <name>Onboarding_Product</name>
        <label>Onboarding Product</label>
        <locationX>666</locationX>
        <locationY>998</locationY>
        <defaultConnector>
            <targetReference>Loop_Opportunities</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Other</defaultConnectorLabel>
        <rules>
            <name>Self_Service_School_Reporting</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Opportunities.Campaign.Product__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>School Reporting</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_to_Update_Collection</targetReference>
            </connector>
            <label>Self Service - School Reporting</label>
        </rules>
    </decisions>
    <decisions>
        <description>Checks whether this is the principal user or a delegate user based on isPrincipal property in JSON</description>
        <name>Principal_User</name>
        <label>Principal User?</label>
        <locationX>908</locationX>
        <locationY>566</locationY>
        <defaultConnector>
            <targetReference>Get_Principal</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Delegate</defaultConnectorLabel>
        <rules>
            <name>Principal</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>isPrincipal</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>true</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_event_contact_as_email_recipient</targetReference>
            </connector>
            <label>Principal</label>
        </rules>
    </decisions>
    <decisions>
        <description>Check if there is and Existing Self Service Product Installed for the School</description>
        <name>Product_Status</name>
        <label>Product Status</label>
        <locationX>446</locationX>
        <locationY>1988</locationY>
        <defaultConnector>
            <targetReference>Get_Self_Service_School_Reporting_Product</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No SS Product Active for School</defaultConnectorLabel>
        <rules>
            <name>Self_Service_Active</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Check_for_Existing_Self_Service_Product</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Check_for_Existing_Self_Service_Product.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Active</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Post_Error_Active_Product_Exists</targetReference>
            </connector>
            <label>Self Service Active</label>
        </rules>
        <rules>
            <name>Inactive_SS_Product</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Check_for_Existing_Self_Service_Product</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Check_for_Existing_Self_Service_Product.Status__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Active</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_inactive_SS_Installed_product_to_Active</targetReference>
            </connector>
            <label>Inactive SS Product</label>
        </rules>
    </decisions>
    <description>Manage events from Self-Service
Added Platform Event for deactivating users.
API ver 57</description>
    <environments>Default</environments>
    <formulas>
        <name>DeactivatedUserEmailBody</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE(
SUBSTITUTE({!Get_Deactivation_Email.HtmlValue}, &apos;[First.Name]&apos;, {!getUserToDeactivate.FirstName}),
&apos;[Admin.Name]&apos;, {!getAdminUser_Deactivate.Name})</expression>
    </formulas>
    <formulas>
        <description>HTML body of the email with merge fields replaced</description>
        <name>emailHTMLbody</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE(SUBSTITUTE(SUBSTITUTE({!Get_email_template.HtmlValue}, 
&quot;[First.Name]&quot;, {!EmailRecipient.FirstName}),
&quot;[Login.Link]&quot;, {!loginLink}),
&quot;[Contact.Name]&quot;, {!Get_Contact_Record.Name})</expression>
    </formulas>
    <formulas>
        <description>The developer name of the email template to be sent. Dependent on the isPrincipal property.</description>
        <name>emailTemplateName</name>
        <dataType>String</dataType>
        <expression>IF ( {!Principal} , &quot;Self_Service_OB_4a_You_re_all_set_up_principal&quot;, &quot;Self_Service_OB_4c_Designated_user_is_set_up_principal&quot;)</expression>
    </formulas>
    <formulas>
        <name>RemovedFromSchoolEmailBody</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE(
SUBSTITUTE(
SUBSTITUTE({!Get_Removed_From_School_Email.HtmlValue}, &apos;[First.Name]&apos;, {!getUserToDeactivate.FirstName}),
&apos;[Admin.Name]&apos;, {!getAdminUser_Deactivate.Name}),
&apos;[School.Name]&apos;,{!getSchoolRemovedFrom.Name})</expression>
    </formulas>
    <formulas>
        <name>Subject_RemovedFromSchoolEmail</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE({!Get_Removed_From_School_Email.Subject}, &apos;[School.Name]&apos;, {!getSchoolRemovedFrom.Name})</expression>
    </formulas>
    <formulas>
        <description>Formula that converts Date/Time string received in JSON to Date/Time format. YYYY-MM-DDTHH:mm:ss.sss</description>
        <name>TsAndCsAcceptedDateTime</name>
        <dataType>DateTime</dataType>
        <expression>DATETIMEVALUE({!TsAndCsAcceptedText})</expression>
    </formulas>
    <formulas>
        <description>Change the [] tags in the email body with the corresponding values</description>
        <name>UpdatedContactDetailsEmailBody</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE(
SUBSTITUTE(
SUBSTITUTE(
SUBSTITUTE({!getUpdatedContactEmailTemplate.HtmlValue} , &apos;[First Name]&apos;,{!firstNameForUpdate}), 
&apos;[Admin Name]&apos;, {!getAdminUser.Name}
),
&apos;[New Name]&apos;,  {!firstNameForUpdate} + &apos; &apos; + {!lastNameForUpdate}
),
&apos;[New Phone]&apos;, {!phoneNumberForUpdate}
)</expression>
    </formulas>
    <interviewLabel>N4L PSI Self-Service {!$Flow.CurrentDateTime}</interviewLabel>
    <label>N4L PSI Self-Service</label>
    <loops>
        <description>Loop through Onboarding Opportunities to find the Self-Service Onboarding Opportunity.</description>
        <name>Loop_Opportunities</name>
        <label>Loop Opportunities</label>
        <locationX>446</locationX>
        <locationY>890</locationY>
        <collectionReference>Get_Onboarding_Opportunities_for_School</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Onboarding_Product</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Onboarding_Opportunity</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>In order to avoid mixed DML errors, create a platform event that will trigger a flow to deactivate the user.</description>
        <name>Create_Deactivate_User_Platform_Event</name>
        <label>Create Deactivate User Platform Event</label>
        <locationX>4538</locationX>
        <locationY>674</locationY>
        <connector>
            <targetReference>Get_Deactivation_Email</targetReference>
        </connector>
        <inputAssignments>
            <field>Admin_Id__c</field>
            <value>
                <elementReference>getAdminUser_Deactivate.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Admin_Name__c</field>
            <value>
                <elementReference>getAdminUser_Deactivate.Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Admin_email__c</field>
            <value>
                <elementReference>getAdminUser_Deactivate.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>User_Name__c</field>
            <value>
                <elementReference>getUserToDeactivate.Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>User_email__c</field>
            <value>
                <elementReference>getUserToDeactivate.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>userId__c</field>
            <value>
                <elementReference>getUserToDeactivate.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Deactivate_MyN4L_User__e</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Create an N4L Installed Product Feature record for the Self-Service - School Reporting product for this school</description>
        <name>Create_Self_Service_Installed_Product_Feature</name>
        <label>Create Self Service Installed Product Feature</label>
        <locationX>842</locationX>
        <locationY>2204</locationY>
        <connector>
            <targetReference>Get_email_template</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Post_error_Product_creation_failed</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Active_Date__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>N4L_Product_Features__c</field>
            <value>
                <elementReference>Get_Self_Service_School_Reporting_Product.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>Get_Self_Service_School_Reporting_Product.Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Organisation__c</field>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Active</stringValue>
            </value>
        </inputAssignments>
        <object>Installed_N4L_Product_Feature__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Create a EmailMessage record to log the email to activity timeline / chatter</description>
        <name>Log_email_sent</name>
        <label>Log email sent</label>
        <locationX>908</locationX>
        <locationY>2894</locationY>
        <connector>
            <targetReference>Relate_email_to_contact</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Post_error_Email_failed_to_send</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>EmailTemplateId</field>
            <value>
                <elementReference>Get_email_template.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FromAddress</field>
            <value>
                <elementReference>emailFromAddress</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>HtmlBody</field>
            <value>
                <elementReference>emailHTMLbody</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelatedToId</field>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>3</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>Get_email_template.Subject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ToAddress</field>
            <value>
                <elementReference>EmailRecipient.Email</elementReference>
            </value>
        </inputAssignments>
        <object>EmailMessage</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Create a EmailMessageRelation record to relate the email to the contact</description>
        <name>Relate_email_to_contact</name>
        <label>Relate email to contact</label>
        <locationX>908</locationX>
        <locationY>3002</locationY>
        <connector>
            <targetReference>Post_success_message</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Post_error_Email_failed_to_send</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>EmailMessageId</field>
            <value>
                <elementReference>Log_email_sent</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelationId</field>
            <value>
                <elementReference>EmailRecipient.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelationType</field>
            <value>
                <stringValue>ToAddress</stringValue>
            </value>
        </inputAssignments>
        <object>EmailMessageRelation</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <description>Check to see if there is an existing Self-Service Installed Product Feature for the School</description>
        <name>Check_for_Existing_Self_Service_Product</name>
        <label>Check for Existing Self-Service Product</label>
        <locationX>446</locationX>
        <locationY>1880</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Product_Status</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Organisation__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </filters>
        <filters>
            <field>N4l_Product_Name__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>School Reporting</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Installed_N4L_Product_Feature__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the contact record to populate merge fields</description>
        <name>Get_Contact_Record</name>
        <label>Get Contact Record</label>
        <locationX>908</locationX>
        <locationY>458</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Principal_User</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ContactId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Contact</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Deactivation_Email</name>
        <label>Get Deactivation Email</label>
        <locationX>4538</locationX>
        <locationY>782</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Send_Deactivated_Email</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>MyN4L_Your_account_has_been_deactivated</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>EmailTemplate</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the email template for email 4a - You&apos;re all set up</description>
        <name>Get_email_template</name>
        <label>Get email template</label>
        <locationX>908</locationX>
        <locationY>2678</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Send_email_4a_You_re_all_set_up</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>emailTemplateName</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>EmailTemplate</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get all Onboarding Opportunities for the School to loop through and find the Self-Service Onboarding Opportunity record.</description>
        <name>Get_Onboarding_Opportunities_for_School</name>
        <label>Get Onboarding Opportunities for School</label>
        <locationX>446</locationX>
        <locationY>782</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Opportunities</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Onboarding</stringValue>
            </value>
        </filters>
        <filters>
            <field>IsClosed</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the Principal of the school the send notification email</description>
        <name>Get_Principal</name>
        <label>Get Principal</label>
        <locationX>1370</locationX>
        <locationY>674</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_school_principal_as_email_recipient</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Current_Principal_Of_This_School__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Contact</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Removed_From_School_Email</name>
        <label>Get Removed From School Email</label>
        <locationX>4802</locationX>
        <locationY>782</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Send_Removed_From_School_Email</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>MyN4L_Your_access_has_been_removed</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>EmailTemplate</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the Product Feature record for Self Service - School Reporting. This is used to created an Installed Product Feature record that links the Product Feature with the School</description>
        <name>Get_Self_Service_School_Reporting_Product</name>
        <label>Get Self Service - School Reporting Product</label>
        <locationX>842</locationX>
        <locationY>2096</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Create_Self_Service_Installed_Product_Feature</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>N4l_Product_Name__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>School Reporting</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>N4L_Product_Features__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>The received JSON contains the ID of the principal/admin user who made the changes to the user record.</description>
        <name>getAdminUser</name>
        <label>getAdminUser</label>
        <locationX>2690</locationX>
        <locationY>566</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>assignValuesForUpdate</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Contact_not_found</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>adminUserId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>The admin user deactivating the user</description>
        <name>getAdminUser_Deactivate</name>
        <label>getAdminUser_Deactivate</label>
        <locationX>4802</locationX>
        <locationY>458</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Deactivate_Or_Remove_From_School</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Admin_User_not_found_Deactivate</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>deactive_adminUserId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>getContactForUpdate</name>
        <label>getContactForUpdate</label>
        <locationX>2690</locationX>
        <locationY>458</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>getAdminUser</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Contact_not_found</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>getUserToUpdate.Contact.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Contact</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>getSchoolRemovedFrom</name>
        <label>getSchoolRemovedFrom</label>
        <locationX>4802</locationX>
        <locationY>674</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Removed_From_School_Email</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>deactivate_schoolId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Find the email template &quot;Self Service: Your details have been updated&quot;</description>
        <name>getUpdatedContactEmailTemplate</name>
        <label>getUpdatedContactEmailTemplate</label>
        <locationX>2690</locationX>
        <locationY>998</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Send_Email</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Self_Service_Your_details_have_been_updated</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>EmailTemplate</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>getUserToDeactivate</name>
        <label>getUserToDeactivate</label>
        <locationX>4802</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>getAdminUser_Deactivate</targetReference>
        </connector>
        <faultConnector>
            <targetReference>User_not_found_Deactivate</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>deactivate_userId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Find the user record associated with the contact being updated</description>
        <name>getUserToUpdate</name>
        <label>getUserToUpdate</label>
        <locationX>2690</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>getContactForUpdate</targetReference>
        </connector>
        <faultConnector>
            <targetReference>User_not_found</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>userIdForUpdate</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Populate the Ts and Cs Accepted Date on the Account Contact Relationship record</description>
        <name>Update_ACR_with_Ts_Cs_Accepted_Date</name>
        <label>Update ACR with Ts &amp; Cs Accepted Date</label>
        <locationX>908</locationX>
        <locationY>350</locationY>
        <connector>
            <targetReference>Get_Contact_Record</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Principal_User</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>AccountId</elementReference>
            </value>
        </filters>
        <filters>
            <field>ContactId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ContactId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>N4L_Terms_and_Conditions_Acceptance_Date__c</field>
            <value>
                <elementReference>TsAndCsAcceptedDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>AccountContactRelation</object>
    </recordUpdates>
    <recordUpdates>
        <description>Change the existing SS Installed Product Feature record to Status = &apos;Active&apos;</description>
        <name>Update_inactive_SS_Installed_product_to_Active</name>
        <label>Update inactive SS Installed product to Active</label>
        <locationX>314</locationX>
        <locationY>2096</locationY>
        <connector>
            <targetReference>Get_email_template</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Post_error_Product_creation_failed</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Check_for_Existing_Self_Service_Product.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Active_Date__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Active</stringValue>
            </value>
        </inputAssignments>
        <object>Installed_N4L_Product_Feature__c</object>
    </recordUpdates>
    <recordUpdates>
        <description>Set Self-Service Onboarding Opportunity to Stage = Closed Won</description>
        <name>Update_Opportunity_as_Won</name>
        <label>Update Opportunity as Won</label>
        <locationX>182</locationX>
        <locationY>1490</locationY>
        <connector>
            <targetReference>Check_for_Existing_Self_Service_Product</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Post_Error_Opportunity_update_error</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>opportunitiesForUpdate</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>StageName</field>
            <value>
                <stringValue>Closed Won</stringValue>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <recordUpdates>
        <name>updateContactForUpdate</name>
        <label>updateContactForUpdate</label>
        <locationX>2690</locationX>
        <locationY>890</locationY>
        <connector>
            <targetReference>getUpdatedContactEmailTemplate</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Error_Updating_Contact</targetReference>
        </faultConnector>
        <inputReference>getContactForUpdate</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update the user record associated with the contact with the new details provided over API.</description>
        <name>updateUserForUpdate</name>
        <label>updateUserForUpdate</label>
        <locationX>2690</locationX>
        <locationY>782</locationY>
        <connector>
            <targetReference>updateContactForUpdate</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Error_Updating_User</targetReference>
        </faultConnector>
        <inputReference>getUserToUpdate</inputReference>
    </recordUpdates>
    <runInMode>DefaultMode</runInMode>
    <start>
        <locationX>3257</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Check_Self_Service_Event_Type</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <description>Call subflow to send emails for self service</description>
        <name>N4l_PSI_Self_Service_Sending_Emails</name>
        <label>N4l PSI Self Service - Sending Emails</label>
        <locationX>5858</locationX>
        <locationY>242</locationY>
        <flowName>N4l_PSI_Self_Service_Sending_Emails</flowName>
        <inputAssignments>
            <name>PlatformServicesIntegrationRecords</name>
            <value>
                <elementReference>PSIRecord</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <variables>
        <description>The Id of the School that the Ts and Cs were accepted for.</description>
        <name>AccountId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>ID of the admin user requesting the change to the details</description>
        <name>adminUserId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The Id of the Contact that accepted the Ts and Tcs</description>
        <name>ContactId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Values should be [&apos;removeFromSchool&apos;, &apos;deactivateUser&apos;]</description>
        <name>deactivate_ActionType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>deactivate_schoolId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>deactivate_userId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>deactive_adminUserId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The email address the email is sent from</description>
        <name>emailFromAddress</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>support@n4l.co.nz</stringValue>
        </value>
    </variables>
    <variables>
        <description>The email recipient (principal). If isPrincipal= TRUE, this is determined by the contactId, if the isPrincipal = FALSE, this is the Principal of the school (based on accountId property)</description>
        <name>EmailRecipient</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>firstNameForUpdate</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The text output of the Boolean isPrincipal property parsed from the JSON</description>
        <name>isPrincipal</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>lastNameForUpdate</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The login link to add to the &apos;You&apos;re all set up&apos; email sent to principal. Parsed from JSON</description>
        <name>loginLink</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Collection of IDs for Opportunities to be updated to Stage = Won</description>
        <name>opportunitiesForUpdate</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>phoneNumberForUpdate</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The N4L Platform Services Integration record passed from the main flow.</description>
        <name>PSIRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>N4l_Platform_services_integration__c</objectType>
    </variables>
    <variables>
        <description>Text variable to receive Ts And Cs Accepted Date from JSON. Expected format: YYYY-MM-DDTHH:mm:ss.sssZ</description>
        <name>TsAndCsAcceptedText</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>ID of the user record, parsed from the received JSON.</description>
        <name>userIdForUpdate</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varUserToDeactivate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>User</objectType>
    </variables>
</Flow>
