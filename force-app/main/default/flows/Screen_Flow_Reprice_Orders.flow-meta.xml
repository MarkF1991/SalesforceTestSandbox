<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>57.0</apiVersion>
    <assignments>
        <description>Add the contract Id to the list of contracts to clone</description>
        <name>Add_contract_Id_to_clone_list</name>
        <label>Add contract Id to clone list</label>
        <locationX>270</locationX>
        <locationY>1514</locationY>
        <assignmentItems>
            <assignToReference>activeContractIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_selected_Draft_Orders.ContractId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_orderIds_list</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add the ID of the cloned order to a string collection - used to update the orders to initiate repricing asynchronously</description>
        <name>Add_new_Order_Id_to_Collection</name>
        <label>Add new Order Id to Collection</label>
        <locationX>270</locationX>
        <locationY>4478</locationY>
        <assignmentItems>
            <assignToReference>originalOrderIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_new_orders_to_reprice.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_new_orders_to_reprice</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add the ID of the original order to a string collection - this collection is used to update the orders to trigger repricing.</description>
        <name>Add_Order_Id_to_Collection</name>
        <label>Add Order Id to Collection</label>
        <locationX>534</locationX>
        <locationY>1514</locationY>
        <assignmentItems>
            <assignToReference>originalOrderIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_selected_Draft_Orders.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_selected_Draft_Orders</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add the ID of the original order to a string collection - used to reprice the orders</description>
        <name>Add_Order_Id_to_Collection_for_reprice</name>
        <label>Add Order Id to Collection for reprice</label>
        <locationX>1062</locationX>
        <locationY>2978</locationY>
        <assignmentItems>
            <assignToReference>originalOrderIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_all_orders_to_reprice_on_existing_contract.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_all_orders_to_reprice_on_existing_contract</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add the cloned contract to the list of contracts to be created</description>
        <name>Add_to_create_list</name>
        <label>Add to create list</label>
        <locationX>490</locationX>
        <locationY>3362</locationY>
        <assignmentItems>
            <assignToReference>newContracts</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>tempContract</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Contracts</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_to_inactivePricebookIds_collection</name>
        <label>Add to inactivePricebookIds collection</label>
        <locationX>270</locationX>
        <locationY>458</locationY>
        <assignmentItems>
            <assignToReference>inactivePricebookIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_old_pricebooks.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_old_pricebooks</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add to a list of contract Ids that will be excluded from cloning / cancelling because the reprice does not affect the school</description>
        <name>Add_to_list_do_not_clone</name>
        <label>Add to list - do not clone</label>
        <locationX>974</locationX>
        <locationY>2762</locationY>
        <assignmentItems>
            <assignToReference>contractIdsDoNotClone</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Contracts.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_all_orders_to_reprice_on_existing_contract</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add the Id of the newly created contract to the newContractIds collection</description>
        <name>Add_to_newContractIds_collection</name>
        <label>Add to newContractIds collection</label>
        <locationX>270</locationX>
        <locationY>4070</locationY>
        <assignmentItems>
            <assignToReference>newContractIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_new_contracts_to_get_Ids.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_new_contracts_to_get_Ids</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add to a list of order Ids that may need to be repriced on a new contract</description>
        <name>Add_to_orderIds_list</name>
        <label>Add to orderIds list</label>
        <locationX>270</locationX>
        <locationY>1622</locationY>
        <assignmentItems>
            <assignToReference>activeContractOrderIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_selected_Draft_Orders.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_validate_orders_for_contract_creation_list</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add to a collection of orders that need to be validated to determine whether there is an increase in cost to school (not only increase in charge to MOE). If there is an increase in the cost to the school, create a new contract. Otherwise just reprice the order on the existing contract.</description>
        <name>Add_to_validate_orders_for_contract_creation_list</name>
        <label>Add to validate orders for contract creation list</label>
        <locationX>270</locationX>
        <locationY>1730</locationY>
        <assignmentItems>
            <assignToReference>ordersForValidation</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_selected_Draft_Orders</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_selected_Draft_Orders</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Get the size of the filtered collection and assign it to a variable to use in the decision</description>
        <name>Assign_count_of_charge_to_school</name>
        <label>Assign count of charge to school</label>
        <locationX>732</locationX>
        <locationY>2438</locationY>
        <assignmentItems>
            <assignToReference>chargeToSchoolOrderCount</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Filter_charge_to_N4L_for_validation</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Does_the_cost_to_school_change</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assign the count of orders to reprice to a number variable</description>
        <name>Assign_number_of_orders_to_reprice</name>
        <label>Assign number of orders to reprice</label>
        <locationX>182</locationX>
        <locationY>1190</locationY>
        <assignmentItems>
            <assignToReference>totalOrdersSelectedForRepricing</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>orderSelectedForUpdate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_selected_Draft_Orders</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assign the counts to be displayed on the success / in progress screen</description>
        <name>Assign_orders_to_reprice_count</name>
        <label>Assign orders to reprice count</label>
        <locationX>182</locationX>
        <locationY>4994</locationY>
        <assignmentItems>
            <assignToReference>numberOfOrdersToReprice</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Get_Orders</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>numberOfErrors</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Get_Errors</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>More_orders_to_reprice</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Set the related case field for the new contract based on the case with a relationship to the master</description>
        <name>Assign_Related_case</name>
        <label>Assign Related case</label>
        <locationX>446</locationX>
        <locationY>3086</locationY>
        <assignmentItems>
            <assignToReference>tempContract.Related_Case__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_case_collection.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_case_collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Set the related case field for the new contract based on the related case for the previous case (only variation and reprice contracts have the &apos;related case&apos; field populated)</description>
        <name>Assign_Related_case_based_on_previous_case</name>
        <label>Assign Related case based on previous case</label>
        <locationX>622</locationX>
        <locationY>2870</locationY>
        <assignmentItems>
            <assignToReference>tempContract.Related_Case__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Related_Case__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_create_list</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Copy the contract fields into a temp contract variable.</description>
        <name>Clone_Contract</name>
        <label>Clone Contract</label>
        <locationX>490</locationX>
        <locationY>2654</locationY>
        <assignmentItems>
            <assignToReference>tempContract.AccountId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Annual_Contribution__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Annual_Contribution__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Contract_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Reprice</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.ContractTerm</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.ContractTerm</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Educount_Rolls__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Educount_Rolls__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Educount_Rolls_as_at__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Educount_Rolls_as_at__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.EndDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.EndDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.MoE_Party_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.MoE_Party_Email__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.MoE_Party_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.MoE_Party_Name__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.N4L_Signatory_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.N4L_Signatory_Email__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.N4L_Signatory_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.N4L_Signatory_Name__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.CustomerSignedId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.CustomerSignedId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Per_Pupil_Contribution__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Per_Pupil_Contribution__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Product__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Programme__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Programme__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Draft</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Parent_Contract__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>masterContractId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>tempContract.Previous_Contract__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Contracts.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Contract_Type</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Record the total draft order number in a variable</description>
        <name>Set_total_order_number</name>
        <label>Set total order number</label>
        <locationX>182</locationX>
        <locationY>758</locationY>
        <assignmentItems>
            <assignToReference>totalDraftOrders</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Get_Draft_Orders</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Introduction</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <description>Filter to get all the reprice orders for this contract to add them to the reprice collection</description>
        <name>filter_all_orders_to_be_repriced_for_contract</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>filter all orders to be repriced for contract</label>
        <locationX>974</locationX>
        <locationY>2654</locationY>
        <assignNextValueToReference>currentItem_Filter_charge_to_N4L_for_validation</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>ordersForValidation</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_charge_to_N4L_for_validation.ContractId</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_Contracts.Id</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Add_to_list_do_not_clone</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Filter the case collection to include only those related to the loop contract</description>
        <name>Filter_cases_for_contract</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter cases for contract</label>
        <locationX>358</locationX>
        <locationY>2870</locationY>
        <assignNextValueToReference>currentItem_Filter_cases_for_contract_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Cases</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_cases_for_contract_0.Contract__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_Contracts.Id</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Loop_case_collection</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Filter the validate collection to include only orders for this contract, and only orders that are charge to school (N4L)</description>
        <name>Filter_charge_to_N4L_for_validation</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter charge to N4L for validation</label>
        <locationX>732</locationX>
        <locationY>2330</locationY>
        <assignNextValueToReference>currentItem_Filter_charge_to_N4L_for_validation</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>ordersForValidation</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_charge_to_N4L_for_validation.ContractId</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_Contracts.Id</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_Filter_charge_to_N4L_for_validation.Charge_To__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <stringValue>N4L</stringValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Assign_count_of_charge_to_school</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>The screen component can only display 200 orders</description>
        <name>Keep_200_Orders_only</name>
        <elementSubtype>SortCollectionProcessor</elementSubtype>
        <label>Keep 200 Orders only</label>
        <locationX>182</locationX>
        <locationY>974</locationY>
        <collectionProcessorType>SortCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Draft_Orders</collectionReference>
        <connector>
            <targetReference>Preview_Draft_Orders</targetReference>
        </connector>
        <limit>200</limit>
        <sortOptions>
            <doesPutEmptyStringAndNullFirst>false</doesPutEmptyStringAndNullFirst>
            <sortField>CreatedDate</sortField>
            <sortOrder>Desc</sortOrder>
        </sortOptions>
    </collectionProcessors>
    <decisions>
        <description>Is the contract active (signed by school)? If active, we may need to create a new reprice contract</description>
        <name>Contract_Status</name>
        <label>Contract Status?</label>
        <locationX>402</locationX>
        <locationY>1406</locationY>
        <defaultConnector>
            <targetReference>Add_Order_Id_to_Collection</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Inactive</defaultConnectorLabel>
        <rules>
            <name>Active</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_through_selected_Draft_Orders.Contract.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Activated</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_contract_Id_to_clone_list</targetReference>
            </connector>
            <label>Active</label>
        </rules>
    </decisions>
    <decisions>
        <description>Contract type will determine how to retrieve the related case.</description>
        <name>Contract_Type</name>
        <label>Contract Type</label>
        <locationX>490</locationX>
        <locationY>2762</locationY>
        <defaultConnector>
            <targetReference>Assign_Related_case_based_on_previous_case</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Other</defaultConnectorLabel>
        <rules>
            <name>Master</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Contracts.Contract_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Master</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Filter_cases_for_contract</targetReference>
            </connector>
            <label>Master</label>
        </rules>
    </decisions>
    <decisions>
        <description>Are there any charge to N4L orders in the filtered collection?</description>
        <name>Does_the_cost_to_school_change</name>
        <label>Does the cost to school change?</label>
        <locationX>732</locationX>
        <locationY>2546</locationY>
        <defaultConnector>
            <targetReference>filter_all_orders_to_be_repriced_for_contract</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Change in charge to MOE only</defaultConnectorLabel>
        <rules>
            <name>Change_in_charge_to_school</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Filter_charge_to_N4L_for_validation</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>chargeToSchoolOrderCount</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Clone_Contract</targetReference>
            </connector>
            <label>Change in charge to school</label>
        </rules>
    </decisions>
    <decisions>
        <description>Check the progress of the repricing. Are there still orders queued to be repriced or have all orders been processed?</description>
        <name>More_orders_to_reprice</name>
        <label>More orders to reprice?</label>
        <locationX>182</locationX>
        <locationY>5102</locationY>
        <defaultConnector>
            <targetReference>Reprice_in_progress_screen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Repricing incomplete</defaultConnectorLabel>
        <rules>
            <name>All_orders_processed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>numberOfOrdersToReprice</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Success</targetReference>
            </connector>
            <label>All orders processed</label>
        </rules>
    </decisions>
    <description>A screenflow on the Price Book page which allows an admin to reprice all draft orders to use the new pricebook</description>
    <environments>Default</environments>
    <formulas>
        <description>Used in the loop to set the master contract Id on the reprice contract. If the original contract is a Master contract, use that contract. Otherwise use the parent of the original contract</description>
        <name>masterContractId</name>
        <dataType>String</dataType>
        <expression>IF(ISPICKVAL({!Loop_Contracts.Contract_Type__c}, &quot;Master&quot;), {!Loop_Contracts.Id}, {!Loop_Contracts.Parent_Contract__c})</expression>
    </formulas>
    <formulas>
        <description>The total number of batches to complete repricing</description>
        <name>totalBatches</name>
        <dataType>Number</dataType>
        <expression>CEILING({!totalDraftOrders}/{!batchSize})</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <description>Total number of orders repriced successfully</description>
        <name>totalOrdersRepriced</name>
        <dataType>Number</dataType>
        <expression>{!totalOrdersSelectedForRepricing} - {!numberOfErrors}</expression>
        <scale>0</scale>
    </formulas>
    <interviewLabel>Screen Flow: Reprice Orders {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Screen Flow: Reprice Orders</label>
    <loops>
        <name>Loop_all_orders_to_reprice_on_existing_contract</name>
        <label>Loop all orders to reprice on existing contract</label>
        <locationX>974</locationX>
        <locationY>2870</locationY>
        <collectionReference>filter_all_orders_to_be_repriced_for_contract</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Order_Id_to_Collection_for_reprice</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Contracts</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Loop the filtered case collection, this will only include one case which is the case related to the loop variable</description>
        <name>Loop_case_collection</name>
        <label>Loop case &apos;collection&apos;</label>
        <locationX>358</locationX>
        <locationY>2978</locationY>
        <collectionReference>Filter_cases_for_contract</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Related_case</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Add_to_create_list</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Loop the contract records to clone</description>
        <name>Loop_Contracts</name>
        <label>Loop Contracts</label>
        <locationX>182</locationX>
        <locationY>2222</locationY>
        <collectionReference>Get_Contracts_to_clone</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Filter_charge_to_N4L_for_validation</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_reprice_contracts</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_new_contracts_to_get_Ids</name>
        <label>Loop new contracts to get Ids</label>
        <locationX>182</locationX>
        <locationY>3962</locationY>
        <collectionReference>newContracts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_to_newContractIds_collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_orders_to_reprice_for_new_contract</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Loop through the newly created orders to be repriced. Add them to the list of orders to update with reprice information</description>
        <name>Loop_new_orders_to_reprice</name>
        <label>Loop new orders to reprice</label>
        <locationX>182</locationX>
        <locationY>4370</locationY>
        <collectionReference>Get_orders_to_reprice_for_new_contract</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_new_Order_Id_to_Collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_orders_to_trigger_reprice</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Loop through the old pricebooks to build a colllection of old pricebook IDs</description>
        <name>Loop_through_old_pricebooks</name>
        <label>Loop through old pricebooks</label>
        <locationX>182</locationX>
        <locationY>350</locationY>
        <collectionReference>Get_all_inactive_pricebooks_with_the_same_provider</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_to_inactivePricebookIds_collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Draft_Orders</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_through_selected_Draft_Orders</name>
        <label>Loop through selected Draft Orders</label>
        <locationX>182</locationX>
        <locationY>1298</locationY>
        <collectionReference>orderSelectedForUpdate</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Contract_Status</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Contracts_to_clone</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <description>Create the reprice contracts. A record-triggered flow on the contract object will clone all orders from the original contract to the reprice contract.</description>
        <name>Create_reprice_contracts</name>
        <label>Create reprice contracts</label>
        <locationX>182</locationX>
        <locationY>3638</locationY>
        <connector>
            <targetReference>Cancel_original_contracts</targetReference>
        </connector>
        <inputReference>newContracts</inputReference>
    </recordCreates>
    <recordLookups>
        <description>Use this list to locate draft orders linked to the old pricebooks</description>
        <name>Get_all_inactive_pricebooks_with_the_same_provider</name>
        <label>Get all inactive pricebooks with the same provider</label>
        <locationX>182</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_through_old_pricebooks</targetReference>
        </connector>
        <filterLogic>1 AND 2 AND 3 AND NOT (4)</filterLogic>
        <filters>
            <field>Provider__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Current_Pricebook.Provider__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Provider__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Equipment Only</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Pricebook2</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get cases to populate the related case field on the contract record.</description>
        <name>Get_Cases</name>
        <label>Get Cases</label>
        <locationX>182</locationX>
        <locationY>2114</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Contracts</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Contract__c</field>
            <operator>In</operator>
            <value>
                <elementReference>activeContractIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Contracts_to_clone</name>
        <label>Get Contracts to clone</label>
        <locationX>182</locationX>
        <locationY>2006</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Cases</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>activeContractIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Contract</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the current (new) pricebook record.</description>
        <name>Get_Current_Pricebook</name>
        <label>Get Current Pricebook</label>
        <locationX>182</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_all_inactive_pricebooks_with_the_same_provider</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>pricebookId</elementReference>
            </value>
        </filters>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Pricebook2</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get all draft orders that don&apos;t use the current pricebook</description>
        <name>Get_Draft_Orders</name>
        <label>Get Draft Orders</label>
        <locationX>182</locationX>
        <locationY>650</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_total_order_number</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Pricebook2Id</field>
            <operator>In</operator>
            <value>
                <elementReference>inactivePricebookIds</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Draft</stringValue>
            </value>
        </filters>
        <filters>
            <field>OrderItemsCount__c</field>
            <operator>GreaterThan</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Order</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>If there are any errors repricing the order, the &apos;repricing error&apos; checkbox is checked and the error is recorded in &apos;Repricing Error Message&apos; field</description>
        <name>Get_Errors</name>
        <label>Get Errors</label>
        <locationX>182</locationX>
        <locationY>4886</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_orders_to_reprice_count</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>originalOrderIds</elementReference>
            </value>
        </filters>
        <filters>
            <field>Repricing_Error__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Order</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the orders to see how many still need to be repriced</description>
        <name>Get_Orders</name>
        <label>Get Orders</label>
        <locationX>182</locationX>
        <locationY>4778</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Errors</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>originalOrderIds</elementReference>
            </value>
        </filters>
        <filters>
            <field>Repricing_Error__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Order</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get all the orders that need to be repriced on the new contract</description>
        <name>Get_orders_to_reprice_for_new_contract</name>
        <label>Get orders to reprice for new contract</label>
        <locationX>182</locationX>
        <locationY>4262</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_new_orders_to_reprice</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ContractId</field>
            <operator>In</operator>
            <value>
                <elementReference>newContractIds</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Draft</stringValue>
            </value>
        </filters>
        <filters>
            <field>Previous_Order_Id__c</field>
            <operator>In</operator>
            <value>
                <elementReference>activeContractOrderIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Order</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Now that the contract is cloned, change the original order status to &apos;Cancelled&apos;</description>
        <name>Cancel_original_contracts</name>
        <label>Cancel original contracts</label>
        <locationX>182</locationX>
        <locationY>3746</locationY>
        <connector>
            <targetReference>Cancel_original_orders</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>activeContractIds</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>NotIn</operator>
            <value>
                <elementReference>contractIdsDoNotClone</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Cancelled</stringValue>
            </value>
        </inputAssignments>
        <object>Contract</object>
    </recordUpdates>
    <recordUpdates>
        <description>Cancel all orders in draft status on the original contract</description>
        <name>Cancel_original_orders</name>
        <label>Cancel original orders</label>
        <locationX>182</locationX>
        <locationY>3854</locationY>
        <connector>
            <targetReference>Loop_new_contracts_to_get_Ids</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ContractId</field>
            <operator>In</operator>
            <value>
                <elementReference>activeContractIds</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Activated</stringValue>
            </value>
        </filters>
        <filters>
            <field>OrderItemsCount__c</field>
            <operator>GreaterThan</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </filters>
        <filters>
            <field>ContractId</field>
            <operator>NotIn</operator>
            <value>
                <elementReference>contractIdsDoNotClone</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Cancelled</stringValue>
            </value>
        </inputAssignments>
        <object>Order</object>
    </recordUpdates>
    <recordUpdates>
        <description>Check the &apos;reprice&apos; checkbox and input the new pricebook Ids into fields on the order records. Orders will be repriced asynchronously in a separate transaction by a record-triggered flow on the Order object.</description>
        <name>Update_orders_to_trigger_reprice</name>
        <label>Update orders to trigger reprice</label>
        <locationX>182</locationX>
        <locationY>4670</locationY>
        <connector>
            <targetReference>Get_Orders</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>originalOrderIds</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>New_Pricebook_ID__c</field>
            <value>
                <elementReference>pricebookId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Reprice__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Repricing_Error_Message__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Repricing_Error__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <object>Order</object>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <screens>
        <description>Introduce the function of the flow</description>
        <name>Introduction</name>
        <label>Introduction</label>
        <locationX>182</locationX>
        <locationY>866</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Keep_200_Orders_only</targetReference>
        </connector>
        <fields>
            <name>heading</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;font-size: 16px;&quot;&gt;Reprice draft orders for {!Get_Current_Pricebook.Provider__r.Name}&lt;/strong&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>batchSummary</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Number of Draft orders to reprice: &lt;/strong&gt;{!totalDraftOrders}&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Batch Size: &lt;/strong&gt;{!batchSize}&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Batches:&lt;/strong&gt; {!totalBatches}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>PromptToProceed</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;Click &lt;/span&gt;&lt;strong style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;Next &lt;/strong&gt;&lt;span style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;to review orders&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Preview_Draft_Orders</name>
        <label>Preview Draft Orders</label>
        <locationX>182</locationX>
        <locationY>1082</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Assign_number_of_orders_to_reprice</targetReference>
        </connector>
        <fields>
            <name>Instructions</name>
            <fieldText>&lt;p&gt;Select Orders for repricing&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Draft_Orders_DataTable</name>
            <dataTypeMappings>
                <typeName>T</typeName>
                <typeValue>Order</typeValue>
            </dataTypeMappings>
            <extensionName>flowruntime:datatable</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Draft Orders</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>selectionMode</name>
                <value>
                    <stringValue>MULTI_SELECT</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>minRowSelection</name>
                <value>
                    <numberValue>0.0</numberValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>tableData</name>
                <value>
                    <elementReference>Get_Draft_Orders</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>selectedRows</name>
                <value>
                    <elementReference>Get_Draft_Orders</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columns</name>
                <value>
                    <stringValue>[{&quot;apiName&quot;:&quot;OrderNumber&quot;,&quot;guid&quot;:&quot;column-da13&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:0,&quot;label&quot;:&quot;Order Number&quot;,&quot;type&quot;:&quot;text&quot;},{&quot;apiName&quot;:&quot;School_Name__c&quot;,&quot;guid&quot;:&quot;column-ab46&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:true,&quot;customHeaderLabel&quot;:&quot;School&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:1,&quot;label&quot;:&quot;School Name&quot;,&quot;type&quot;:&quot;customRichText&quot;},{&quot;apiName&quot;:&quot;Type&quot;,&quot;guid&quot;:&quot;column-1ecb&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:2,&quot;label&quot;:&quot;Order Type&quot;,&quot;type&quot;:&quot;text&quot;},{&quot;apiName&quot;:&quot;Charge_To__c&quot;,&quot;guid&quot;:&quot;column-011f&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:3,&quot;label&quot;:&quot;Charge To&quot;,&quot;type&quot;:&quot;text&quot;},{&quot;apiName&quot;:&quot;Price_Book_Name__c&quot;,&quot;guid&quot;:&quot;column-e1d3&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:true,&quot;customHeaderLabel&quot;:&quot;Price Book&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:4,&quot;label&quot;:&quot;Price Book Name&quot;,&quot;type&quot;:&quot;customRichText&quot;},{&quot;apiName&quot;:&quot;ContractId&quot;,&quot;guid&quot;:&quot;column-a5dc&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:5,&quot;label&quot;:&quot;Contract ID&quot;,&quot;type&quot;:&quot;customRichText&quot;},{&quot;apiName&quot;:&quot;TotalAmount&quot;,&quot;guid&quot;:&quot;column-1dbd&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:6,&quot;label&quot;:&quot;Order Amount&quot;,&quot;type&quot;:&quot;currency&quot;},{&quot;apiName&quot;:&quot;DiscountedTotalAmount__c&quot;,&quot;guid&quot;:&quot;column-6093&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:7,&quot;label&quot;:&quot;Discounted Order Amount&quot;,&quot;type&quot;:&quot;currency&quot;}]</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>shouldDisplayLabel</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>isShowSearchBar</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>orderSelectedForUpdate</assignToReference>
                <name>selectedRows</name>
            </outputParameters>
        </fields>
        <nextOrFinishButtonLabel>Reprice</nextOrFinishButtonLabel>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <description>Screen that displays the progress of the reprice</description>
        <name>Reprice_in_progress_screen</name>
        <label>Reprice in progress</label>
        <locationX>314</locationX>
        <locationY>5210</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Get_Orders</targetReference>
        </connector>
        <fields>
            <name>Reprice_In_Progress</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Orders queued for repricing&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;{!numberOfOrdersToReprice} of {!totalOrdersSelectedForRepricing} orders remaining&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <nextOrFinishButtonLabel>Recheck status</nextOrFinishButtonLabel>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <description>Screen displayed when all orders have been processed</description>
        <name>Success</name>
        <label>Success Screen</label>
        <locationX>50</locationX>
        <locationY>5210</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>SuccessMessage</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Repricing complete&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;{!totalOrdersRepriced} of {!totalOrdersSelectedForRepricing} orders repriced successfully&lt;/p&gt;&lt;p&gt;Errors: {!numberOfErrors}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>errortable</name>
            <dataTypeMappings>
                <typeName>T</typeName>
                <typeValue>Order</typeValue>
            </dataTypeMappings>
            <extensionName>flowruntime:datatable</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Review Errors</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>selectionMode</name>
                <value>
                    <stringValue>NO_SELECTION</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>minRowSelection</name>
                <value>
                    <numberValue>0.0</numberValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>tableData</name>
                <value>
                    <elementReference>Get_Errors</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>maxRowSelection</name>
                <value>
                    <numberValue>0.0</numberValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columns</name>
                <value>
                    <stringValue>[{&quot;apiName&quot;:&quot;OrderNumber&quot;,&quot;guid&quot;:&quot;column-0804&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:0,&quot;label&quot;:&quot;Order Number&quot;,&quot;type&quot;:&quot;text&quot;},{&quot;apiName&quot;:&quot;Repricing_Error_Message__c&quot;,&quot;guid&quot;:&quot;column-13da&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:true,&quot;customHeaderLabel&quot;:&quot;Error&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:1,&quot;label&quot;:&quot;Repricing Error Message&quot;,&quot;type&quot;:&quot;text&quot;}]</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>shouldDisplayLabel</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>ResetValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>numberOfErrors</leftValueReference>
                    <operator>GreaterThan</operator>
                    <rightValue>
                        <numberValue>0.0</numberValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Current_Pricebook</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <description>A list of contract Ids that need to be cloned to create a reprice contract</description>
        <name>activeContractIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Collection of order Ids on active contracts that need to be repriced</description>
        <name>activeContractOrderIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Size of reprice batches. This doesn&apos;t actually control the batch size (see sort element), it is used to display the batch size and calculate total batches</description>
        <name>batchSize</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>200.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>The number of orders charged to school (N4L) for repricing</description>
        <name>chargeToSchoolOrderCount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <description>Collection of Ids of activated contracts that don&apos;t need to be cloned and cancelled because the reprice does not result in a change in the charge to the school</description>
        <name>contractIdsDoNotClone</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>currentItem_Filter_cases_for_contract_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_charge_to_N4L_for_validation</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Order</objectType>
    </variables>
    <variables>
        <description>error message to display</description>
        <name>errorMessage</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>$Flow.FaultMessage</elementReference>
        </value>
    </variables>
    <variables>
        <description>A collection of IDs of inactive pricebooks, used to find the draft orders that are related to retired pricebooks</description>
        <name>inactivePricebookIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>A list of new &apos;reprice&apos; contract Ids</description>
        <name>newContractIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>A list of clone contracts to be created</description>
        <name>newContracts</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contract</objectType>
    </variables>
    <variables>
        <name>numberOfErrors</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>numberOfOrdersToReprice</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <description>A collection of draft order records selected by the user to reprice</description>
        <name>orderSelectedForUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Order</objectType>
    </variables>
    <variables>
        <description>A collection of orders to be validated to determine if there is a change in the cost to school after repricing all orders on the contract that were selected by the user.</description>
        <name>ordersForValidation</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Order</objectType>
    </variables>
    <variables>
        <description>Used to get the order products</description>
        <name>originalOrderIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>ID of the new (current) pricebook</description>
        <name>pricebookId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Loop variable for the new contracts to be inserted</description>
        <name>tempContract</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contract</objectType>
    </variables>
    <variables>
        <description>The total number of orders for repricing</description>
        <name>totalDraftOrders</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>totalOrdersSelectedForRepricing</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
</Flow>
