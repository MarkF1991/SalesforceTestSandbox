<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Email to notify SDS that the ATP will require attention</description>
        <name>Send_email_to_SDS_ATP_requires_attention</name>
        <label>Send email to SDS - ATP requires attention</label>
        <locationX>165</locationX>
        <locationY>2771</locationY>
        <actionName>ATP__c.ATP_requires_attention_Notify_SDS</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>ATP__c.ATP_requires_attention_Notify_SDS</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>56.0</apiVersion>
    <assignments>
        <description>There is no internal IT Lead, this needs attention from the SDS. Assign technical contact variables to set ERROR status and message</description>
        <name>Assign_error_variables</name>
        <label>Assign error variables</label>
        <locationX>882</locationX>
        <locationY>1895</locationY>
        <assignmentItems>
            <assignToReference>technicalContactStatus</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>ERROR</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>techncalContactErrorMessage</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>External ICT is not specified and there is no internal IT Lead for this school. </stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_signatory_to_opportunity</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assign the count of contacts in the collection to a variable to check if there is an IT lead.</description>
        <name>Assign_IT_Lead_count</name>
        <label>Assign IT Lead count</label>
        <locationX>774</locationX>
        <locationY>1679</locationY>
        <assignmentItems>
            <assignToReference>countOfITLeads</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Filter_IT_Lead_only</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Internal_IT_Lead</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <description>Filter the collection to get the IT Lead only. This is a workaround because SF does not allow using &apos;contains&apos; for multipicklists in Get elements</description>
        <name>Filter_IT_Lead_only</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter IT Lead only</label>
        <locationX>774</locationX>
        <locationY>1463</locationY>
        <assignNextValueToReference>currentItem_Filter_IT_Lead_only_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_School_Contacts</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_IT_Lead_only_0.Roles</leftValueReference>
            <operator>Contains</operator>
            <rightValue>
                <stringValue>IT Lead</stringValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Keep_most_recent_IT_Lead</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Sort the collection by created date and keep only the first record</description>
        <name>Keep_most_recent_IT_Lead</name>
        <elementSubtype>SortCollectionProcessor</elementSubtype>
        <label>Keep most recent IT Lead</label>
        <locationX>774</locationX>
        <locationY>1571</locationY>
        <collectionProcessorType>SortCollectionProcessor</collectionProcessorType>
        <collectionReference>Filter_IT_Lead_only</collectionReference>
        <connector>
            <targetReference>Assign_IT_Lead_count</targetReference>
        </connector>
        <limit>1</limit>
        <sortOptions>
            <doesPutEmptyStringAndNullFirst>false</doesPutEmptyStringAndNullFirst>
            <sortField>CreatedDate</sortField>
            <sortOrder>Desc</sortOrder>
        </sortOptions>
    </collectionProcessors>
    <decisions>
        <description>Check whether there have been any errors in the subflows</description>
        <name>Check_for_errors</name>
        <label>Check for errors</label>
        <locationX>297</locationX>
        <locationY>2663</locationY>
        <defaultConnector>
            <targetReference>Update_Opportunity_to_Committed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>SUCCESS</defaultConnectorLabel>
        <rules>
            <name>ERROR</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Add_Primary_Contact_to_opportunity.status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ERROR</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Add_secondary_contact_opportunity_role.status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ERROR</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Add_signatory_to_opportunity.status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ERROR</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>technicalContactStatus</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ERROR</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_email_to_SDS_ATP_requires_attention</targetReference>
            </connector>
            <label>ERROR</label>
        </rules>
    </decisions>
    <decisions>
        <description>Is there an internal IT Lead for the school</description>
        <name>Internal_IT_Lead</name>
        <label>Internal IT Lead?</label>
        <locationX>774</locationX>
        <locationY>1787</locationY>
        <defaultConnector>
            <targetReference>Assign_error_variables</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No IT Lead</defaultConnectorLabel>
        <rules>
            <name>School_has_IT_Lead</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Filter_IT_Lead_only</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>countOfITLeads</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_IT_Lead</targetReference>
            </connector>
            <label>School has IT Lead</label>
        </rules>
    </decisions>
    <decisions>
        <description>Did the school specify an external ICT? If not, the Technical Contact will default to the IT Lead</description>
        <name>Is_ICT_Internal_or_External</name>
        <label>Is ICT Internal or External</label>
        <locationX>544</locationX>
        <locationY>1247</locationY>
        <defaultConnector>
            <targetReference>Get_School_Contacts</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Internal IT Lead</defaultConnectorLabel>
        <rules>
            <name>External_ICT</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.External_ICT_Email__c</leftValueReference>
                <operator>NotEqualTo</operator>
            </conditions>
            <connector>
                <targetReference>Add_external_ICT_as_opportunity_role</targetReference>
            </connector>
            <label>External ICT</label>
        </rules>
    </decisions>
    <decisions>
        <description>Did the school specify a primary contact?</description>
        <name>Primary_Contact</name>
        <label>Primary Contact?</label>
        <locationX>297</locationX>
        <locationY>539</locationY>
        <defaultConnector>
            <targetReference>Secondary_Contact</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No Primary Contact</defaultConnectorLabel>
        <rules>
            <name>Primary_Contact_Specified</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Primary_Contact_Email__c</leftValueReference>
                <operator>NotEqualTo</operator>
            </conditions>
            <connector>
                <targetReference>Add_Primary_Contact_to_opportunity</targetReference>
            </connector>
            <label>Primary Contact Specified</label>
        </rules>
    </decisions>
    <decisions>
        <description>Did the school specify a secondary contact?</description>
        <name>Secondary_Contact</name>
        <label>Secondary Contact?</label>
        <locationX>297</locationX>
        <locationY>839</locationY>
        <defaultConnector>
            <targetReference>Technical_Contact</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No Secondary Contact</defaultConnectorLabel>
        <rules>
            <name>Secondary_Contact_Specified</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Secondary_Contact_Email_Address__c</leftValueReference>
                <operator>NotEqualTo</operator>
            </conditions>
            <connector>
                <targetReference>Add_secondary_contact_opportunity_role</targetReference>
            </connector>
            <label>Secondary Contact Specified</label>
        </rules>
    </decisions>
    <decisions>
        <description>Did the school specify a technical contact? The Technical contact is only included for ES ATPs.</description>
        <name>Technical_Contact</name>
        <label>Technical Contact?</label>
        <locationX>297</locationX>
        <locationY>1139</locationY>
        <defaultConnector>
            <targetReference>Is_ICT_Internal_or_External</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No Technical Contact</defaultConnectorLabel>
        <rules>
            <name>Technical_Contact_Specified</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Technical_Contact_Email__c</leftValueReference>
                <operator>NotEqualTo</operator>
            </conditions>
            <connector>
                <targetReference>Add_technical_contact_as_opportunity_role</targetReference>
            </connector>
            <label>Technical Contact Specified</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <description>Formula to concatenate the error messages from all possible errors.</description>
        <name>errorMessage</name>
        <dataType>String</dataType>
        <expression>IF({!Add_Primary_Contact_to_opportunity.status} == &apos;ERROR&apos;, {!Add_Primary_Contact_to_opportunity.errorMessage} &amp; BR(), &apos;&apos;) &amp;
IF({!Add_secondary_contact_opportunity_role.status}== &apos;ERROR&apos;, {!Add_secondary_contact_opportunity_role.errorMessage} &amp; BR(), &apos;&apos;)  &amp; IF({!Add_signatory_to_opportunity.status} == &apos;ERROR&apos;, {!Add_signatory_to_opportunity.errorMessage} &amp; BR(), &apos;&apos;)  &amp;
IF({!technicalContactStatus} == &apos;ERROR&apos;, {!techncalContactErrorMessage} &amp; BR(), &apos;&apos;)  &amp; 
IF(NOT(ISBLANK({!$Flow.FaultMessage})), {!techncalContactErrorMessage} , &apos;&apos;)</expression>
    </formulas>
    <formulas>
        <description>Formula that evaluates to true if there is an error</description>
        <name>isError</name>
        <dataType>Boolean</dataType>
        <expression>{!Add_Primary_Contact_to_opportunity.status} == &apos;ERROR&apos; || {!Add_secondary_contact_opportunity_role.status}== &apos;ERROR&apos; || {!Add_signatory_to_opportunity.status} == &apos;ERROR&apos; || {!technicalContactStatus} == &apos;ERROR&apos; || NOT(ISBLANK({!$Flow.FaultMessage}))</expression>
    </formulas>
    <interviewLabel>ATP Created {!$Flow.CurrentDateTime}</interviewLabel>
    <label>ATP Created</label>
    <loops>
        <description>There is only 1 IT Lead, but it is in a collection so we need to use a loop</description>
        <name>Loop_IT_Lead</name>
        <label>Loop IT Lead</label>
        <locationX>666</locationX>
        <locationY>1895</locationY>
        <collectionReference>Filter_IT_Lead_only</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_IT_Lead_as_opportunity_role</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Add_signatory_to_opportunity</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Get the opportunity related to this ATP</description>
        <name>Get_Opportunity</name>
        <label>Get Opportunity</label>
        <locationX>297</locationX>
        <locationY>323</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Organisation</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Opportunity__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Organisation</name>
        <label>Get Organisation</label>
        <locationX>297</locationX>
        <locationY>431</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Primary_Contact</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Organisation__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get all the school contacts with a role</description>
        <name>Get_School_Contacts</name>
        <label>Get School Contacts</label>
        <locationX>774</locationX>
        <locationY>1355</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Filter_IT_Lead_only</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Roles</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </filters>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Organisation__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>AccountContactRelation</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_ATP_Contacts</name>
        <label>Update ATP Contacts</label>
        <locationX>297</locationX>
        <locationY>2555</locationY>
        <connector>
            <targetReference>Check_for_errors</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Send_email_to_SDS_ATP_requires_attention</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Error_message__c</field>
            <value>
                <elementReference>errorMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Primary_Contact__c</field>
            <value>
                <elementReference>Add_Primary_Contact_to_opportunity.ContactId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Secondary_Contact__c</field>
            <value>
                <elementReference>Add_secondary_contact_opportunity_role.ContactId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Signatory__c</field>
            <value>
                <elementReference>Add_signatory_to_opportunity.ContactId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Technical_Contact__c</field>
            <value>
                <elementReference>technicalContactId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>isError__c</field>
            <value>
                <elementReference>isError</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Opportunity_to_Committed</name>
        <label>Update Opportunity to Committed</label>
        <locationX>429</locationX>
        <locationY>2771</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Send_email_to_SDS_ATP_requires_attention</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Opportunity.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>StageName</field>
            <value>
                <stringValue>Committed</stringValue>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <start>
        <locationX>171</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Opportunity</targetReference>
        </connector>
        <object>ATP__c</object>
        <recordTriggerType>Create</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Add_external_ICT_as_opportunity_role</name>
        <label>Add external ICT as opportunity role</label>
        <locationX>314</locationX>
        <locationY>1355</locationY>
        <connector>
            <targetReference>Add_signatory_to_opportunity</targetReference>
        </connector>
        <flowName>ATP_Add_opportunity_contact_role</flowName>
        <inputAssignments>
            <name>ContactEmail</name>
            <value>
                <elementReference>$Record.External_ICT_Email__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactFirstName</name>
            <value>
                <elementReference>$Record.External_ICT_First_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactLastName</name>
            <value>
                <elementReference>$Record.External_ICT_Last_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactRole</name>
        </inputAssignments>
        <inputAssignments>
            <name>Opportunity</name>
            <value>
                <elementReference>Get_Opportunity</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Organisation</name>
            <value>
                <elementReference>Get_Organisation</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RoleType</name>
            <value>
                <stringValue>Technical Survey Contact</stringValue>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>technicalContactId</assignToReference>
            <name>ContactId</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>techncalContactErrorMessage</assignToReference>
            <name>errorMessage</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>technicalContactStatus</assignToReference>
            <name>status</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <description>Add the internal IT Lead as the Technical Contact</description>
        <name>Add_IT_Lead_as_opportunity_role</name>
        <label>Add IT Lead as opportunity role</label>
        <locationX>754</locationX>
        <locationY>2003</locationY>
        <connector>
            <targetReference>Loop_IT_Lead</targetReference>
        </connector>
        <flowName>ATP_Add_opportunity_contact_role</flowName>
        <inputAssignments>
            <name>ContactId</name>
            <value>
                <elementReference>Loop_IT_Lead.Contact.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Opportunity</name>
            <value>
                <elementReference>Get_Opportunity</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Organisation</name>
            <value>
                <elementReference>Get_Organisation</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RoleType</name>
            <value>
                <stringValue>Technical Survey Contact</stringValue>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>technicalContactId</assignToReference>
            <name>ContactId</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>techncalContactErrorMessage</assignToReference>
            <name>errorMessage</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>technicalContactStatus</assignToReference>
            <name>status</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>Add_Primary_Contact_to_opportunity</name>
        <label>Add Primary Contact to opportunity</label>
        <locationX>165</locationX>
        <locationY>647</locationY>
        <connector>
            <targetReference>Secondary_Contact</targetReference>
        </connector>
        <flowName>ATP_Add_opportunity_contact_role</flowName>
        <inputAssignments>
            <name>ContactEmail</name>
            <value>
                <elementReference>$Record.Primary_Contact_Email__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactFirstName</name>
            <value>
                <elementReference>$Record.Primary_Contact_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactLastName</name>
            <value>
                <elementReference>$Record.Primary_Contact_Last_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactRole</name>
            <value>
                <elementReference>$Record.Primary_Contact_Role__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Opportunity</name>
            <value>
                <elementReference>Get_Opportunity</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Organisation</name>
            <value>
                <elementReference>Get_Organisation</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RoleType</name>
            <value>
                <stringValue>Primary Contact</stringValue>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>Add_secondary_contact_opportunity_role</name>
        <label>Add secondary contact opportunity role</label>
        <locationX>165</locationX>
        <locationY>947</locationY>
        <connector>
            <targetReference>Technical_Contact</targetReference>
        </connector>
        <flowName>ATP_Add_opportunity_contact_role</flowName>
        <inputAssignments>
            <name>ContactEmail</name>
            <value>
                <elementReference>$Record.Secondary_Contact_Email_Address__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactFirstName</name>
            <value>
                <elementReference>$Record.Secondary_Contact_First_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactLastName</name>
            <value>
                <elementReference>$Record.Secondary_Contact_Last_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactRole</name>
            <value>
                <elementReference>$Record.Secondary_Contact_Role__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Opportunity</name>
            <value>
                <elementReference>Get_Opportunity</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Organisation</name>
            <value>
                <elementReference>Get_Organisation</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RoleType</name>
            <value>
                <stringValue>Secondary Contact</stringValue>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>Add_signatory_to_opportunity</name>
        <label>Add signatory to opportunity</label>
        <locationX>297</locationX>
        <locationY>2447</locationY>
        <connector>
            <targetReference>Update_ATP_Contacts</targetReference>
        </connector>
        <flowName>ATP_Add_opportunity_contact_role</flowName>
        <inputAssignments>
            <name>ContactEmail</name>
            <value>
                <elementReference>$Record.Authrorised_Signatory_Email__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactFirstName</name>
            <value>
                <elementReference>$Record.Authorised_Signatory_First_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactLastName</name>
            <value>
                <elementReference>$Record.Authorised_Signatory_Last_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactPhone</name>
            <value>
                <elementReference>$Record.Authorised_Signatory_Mobile__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactRole</name>
            <value>
                <elementReference>$Record.Authorised_Signatory_Title__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Opportunity</name>
            <value>
                <elementReference>Get_Opportunity</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Organisation</name>
            <value>
                <elementReference>Get_Organisation</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RoleType</name>
            <value>
                <stringValue>Authorised Signatory</stringValue>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>Add_technical_contact_as_opportunity_role</name>
        <label>Add technical contact as opportunity role</label>
        <locationX>50</locationX>
        <locationY>1247</locationY>
        <connector>
            <targetReference>Add_signatory_to_opportunity</targetReference>
        </connector>
        <flowName>ATP_Add_opportunity_contact_role</flowName>
        <inputAssignments>
            <name>ContactEmail</name>
            <value>
                <elementReference>$Record.Technical_Contact_Email__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactFirstName</name>
            <value>
                <elementReference>$Record.Technical_Contact_First_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactLastName</name>
            <value>
                <elementReference>$Record.Technical_Contact_Last_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactRole</name>
            <value>
                <elementReference>$Record.Technical_Contact_Role__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Opportunity</name>
            <value>
                <elementReference>Get_Opportunity</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Organisation</name>
            <value>
                <elementReference>Get_Organisation</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RoleType</name>
            <value>
                <stringValue>Technical Survey Contact</stringValue>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>technicalContactId</assignToReference>
            <name>ContactId</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>techncalContactErrorMessage</assignToReference>
            <name>errorMessage</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>technicalContactStatus</assignToReference>
            <name>status</name>
        </outputAssignments>
    </subflows>
    <variables>
        <description>Number of IT Leads found for the school</description>
        <name>countOfITLeads</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>currentItem_Filter_IT_Lead_only_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AccountContactRelation</objectType>
    </variables>
    <variables>
        <description>The error message returned from the subflow</description>
        <name>techncalContactErrorMessage</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The technical contact can be internal or external. This variable stores the contact ID to input into the &apos;Technical Contact&apos; lookup</description>
        <name>technicalContactId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The status response from the subflow</description>
        <name>technicalContactStatus</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
